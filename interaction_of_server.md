# Как происходит взаимодействие между клиентом и сервером

_Весь Payload это payload относительно Root_


## _Регистрация_ клиента на сервере
Такая _регистрация_ выполняется каждый раз когда открывается соединение (То есть при перезапуске приложения, и при смене сети)

__1__ - __Клиент__ генерирует сертификат, и выбирает пир для подключения

__2__ - __Клиент__ отправляет серверу (пиру) __пакет о регистрации в его _юрисдикции___:

- Payload type: __2__

- Payload:
  ```
  [ Cert length - 2 byte (uint16) ] [ Cert ]
__3__ - __Сервер__ сохраняет сертификат клиента и создает sha256 fingerprint на основе его сертификата для сопоставление в локальной БД. _литерали: `map[sha256 client fingerprint]ClientData`_

__4__ - __Сервер__ отправляет клиенту __пакет об успешной операции__:
- Payload type: __1__
- Payload: _Не предусмотрен_

__5__ - __Клиент__ после этого шлет пакет _keepalive_ каждые пару минут (Таймаут можно выбрать по сути любой, сильно зависит от типа сети и оператора. Для IPv6 его в целом по идее можно не слать).

## Получение Events от сервера

__Сервер__ отправляет клиенту __пакет о новом событии__:

- Payload type: __3__ в случае если Event от самого сервера, __4__ в случае если Event от другого клиента.
  
- Payload __в первом случае__: _Потом придумаю._

- Payload __во втором случае__:
  ```
  [ Fingerprint of remote client - 32 bytes ] [ Event Payload (Потом придумаю) ]
